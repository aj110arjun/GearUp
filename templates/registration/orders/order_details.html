{% extends 'registration/base.html' %}
{% load static %}
{% load cart_extras %}


{% block title %}Order #{{ order.order_number }} - GearUp{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="mb-4">üì¶ Order Details - #{{ order.order_number }}</h2>

  <div class="card mb-4">
    <div class="card-body">
      <h5>Order Summary</h5>
      <p>
        <strong>Status:</strong> 
        {% if order.status == 'PENDING' %}
          <span class="badge bg-secondary">Pending</span>
        {% elif order.status == 'PLACED' %}
          <span class="badge bg-info ">Placed</span>
        {% elif order.status == 'SHIPPED' %}
          <span class="badge bg-warning ">Shipped</span>
        {% elif order.status == 'DELIVERED' %}
          <span class="badge bg-success">Delivered</span>
        {% elif order.status == 'CANCELLED' %}
          <span class="badge bg-danger">Cancelled</span> 
        {% elif order.status == 'RETURNED' %}
          <span class="badge bg-warning">Returned</span>
        {% endif %}
      </p>
      <p><strong>Placed on:</strong> {{ order.created_at|date:"d F Y" }}</p>
      <p><strong>Payment Method:</strong> {{ order.get_payment_method_display }}</p>
      <p><strong>Total:</strong> ‚Çπ{{ order.total_price }}</p>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-body">
      <h5>Shipping Information</h5>
      <p><strong>Name:</strong> {{ order.address.full_name }}</p>
      <p>{{ order.address.street }}, {{ order.address.city }}, {{ order.address.landmark }}</p>
      <p>{{ order.address.pincode }}, {{ order.address.state }}</p>
      <p><strong>Phone:</strong> {{ order.address.phone }}</p>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <h5>Items in this Order</h5>
      <ul class="list-group">
        {% for item in order.items.all %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div class="d-flex">
              <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" style="width: 60px; height: 60px; object-fit: cover; margin-right: 15px;">
              <div>
                <strong>{{ item.product.name }}</strong><br>
                Variant: {{ item.variant.size }} / {{ item.variant.color }}<br>
                Quantity: {{ item.quantity }} √ó ‚Çπ{{ item.price }}
              </div>
            </div>
            <span>‚Çπ{{ item.quantity|multiply:item.price }}</span>
          </li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="mt-4 d-flex justify-content-between">
    <a href="{% url 'view_orders' %}" class="btn btn-secondary">‚Üê Back to Orders</a>
    {% if order.status == 'PLACED' or order.status == 'PENDING' %}
      <form method="POST" action="{% url 'cancel_order' order.order_id %}" style="display:inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger"
              onclick="return confirm('Are you sure you want to cancel this order?');">
              Cancel Order
          </button>
      </form>
    {% endif %}
   {% if order.status == 'DELIVERED' %}
    {% if order.return_status == 'NONE' %}
        <a href="{% url 'return_order' order.order_id %}" class="btn btn-warning">
            Request Return
        </a>

    {% elif order.return_status == 'REQUESTED' %}
        <p class="text-warning mt-2 mb-0 fw-bold">
            Return Requested ‚Äì Pending Approval<br>
        </p>

    {% elif order.return_status == 'APPROVED' %}
        <p class="text-success mt-2 mb-0 fw-bold">
             Return Approved ‚Äì Your return is being processed.
        </p>

    {% elif order.return_status == 'REJECTED' %}
        <p class="text-danger mt-2 mb-0 fw-bold">
              Return Request Rejected by Admin
        </p>
    {% endif %}
{% endif %}

  </div>



</div>
{% endblock %}
